================================================================================
PROYECTO ASTROLOGÃA/PATREON - ESTRUCTURA VISUAL (Mind Map)
================================================================================

PROYECTO ALEJANDRÃA
    â”‚
    â”œâ”€â”€â”€ DOCUMENTACIÃ“N (256 archivos)
    â”‚    â”œâ”€â”€ Activa (docs/)
    â”‚    â”‚   â”œâ”€â”€ ARCHITECTURE.md (diseÃ±o tÃ©cnico - 53KB)
    â”‚    â”‚   â”œâ”€â”€ PHASE0_INSTALLATION.md
    â”‚    â”‚   â”œâ”€â”€ PHASE2_CORE_BACKEND.md
    â”‚    â”‚   â”œâ”€â”€ DATABASE_DESIGN_REVIEW.md
    â”‚    â”‚   â”œâ”€â”€ MEDIA_ARCHITECTURE.md
    â”‚    â”‚   â”œâ”€â”€ SEARCH_IMPROVEMENTS_PLAN.md
    â”‚    â”‚   â””â”€â”€ 16 mÃ¡s...
    â”‚    â”œâ”€â”€ RaÃ­z
    â”‚    â”‚   â”œâ”€â”€ README.md (entrada principal)
    â”‚    â”‚   â”œâ”€â”€ PROGRESS.md (tracking detallado)
    â”‚    â”‚   â”œâ”€â”€ CHANGELOG_2025.md
    â”‚    â”‚   â””â”€â”€ 4 mÃ¡s...
    â”‚    â””â”€â”€ Archivada (archive/docs/)
    â”‚        â””â”€â”€ 15 archivos histÃ³ricos
    â”‚
    â”œâ”€â”€â”€ CÃ“DIGO FUENTE (src/ - 12,416 lÃ­neas)
    â”‚    â”œâ”€â”€ Scrapers (3 fases)
    â”‚    â”‚   â”œâ”€â”€ Phase 1: phase1_url_collector.py
    â”‚    â”‚   â”œâ”€â”€ Phase 2: phase2_detail_extractor.py
    â”‚    â”‚   â””â”€â”€ Phase 3: phase3_collections_scraper.py
    â”‚    â”œâ”€â”€ Scrapers Incrementales
    â”‚    â”‚   â”œâ”€â”€ daily_incremental_scrape.py
    â”‚    â”‚   â”œâ”€â”€ incremental_scraper.py
    â”‚    â”‚   â””â”€â”€ incremental_collections_scraper.py
    â”‚    â”œâ”€â”€ AutenticaciÃ³n
    â”‚    â”‚   â”œâ”€â”€ patreon_auth.py
    â”‚    â”‚   â””â”€â”€ patreon_auth_selenium.py
    â”‚    â”œâ”€â”€ Procesamiento
    â”‚    â”‚   â”œâ”€â”€ content_parser.py (52 KB)
    â”‚    â”‚   â”œâ”€â”€ media_downloader.py (86 KB)
    â”‚    â”‚   â””â”€â”€ tag_generator.py
    â”‚    â”œâ”€â”€ Migraciones
    â”‚    â”‚   â”œâ”€â”€ migrate_json_to_postgres.py
    â”‚    â”‚   â””â”€â”€ migrate_collections_to_postgres.py
    â”‚    â””â”€â”€ Utilidades
    â”‚        â”œâ”€â”€ postgres_tracker.py
    â”‚        â”œâ”€â”€ orchestrator.py
    â”‚        â””â”€â”€ add_creator.py
    â”‚
    â”œâ”€â”€â”€ WEB VIEWER (web/)
    â”‚    â”œâ”€â”€ viewer.py (87 KB - Flask app)
    â”‚    â”œâ”€â”€ search_indexer.py (18 KB)
    â”‚    â”œâ”€â”€ search_index.db (23 MB)
    â”‚    â”œâ”€â”€ static/ (CSS, JS, imÃ¡genes)
    â”‚    â””â”€â”€ templates/ (HTML)
    â”‚
    â”œâ”€â”€â”€ BASE DE DATOS (database/)
    â”‚    â”œâ”€â”€ schema.sql (schema principal - 14 tablas)
    â”‚    â”‚   â”œâ”€â”€ Entidades Core
    â”‚    â”‚   â”‚   â”œâ”€â”€ creators
    â”‚    â”‚   â”‚   â”œâ”€â”€ posts
    â”‚    â”‚   â”‚   â”œâ”€â”€ collections
    â”‚    â”‚   â”‚   â””â”€â”€ post_collections
    â”‚    â”‚   â”œâ”€â”€ Media
    â”‚    â”‚   â”‚   â”œâ”€â”€ media_files (con dedup SHA256)
    â”‚    â”‚   â”‚   â””â”€â”€ post_media
    â”‚    â”‚   â”œâ”€â”€ BÃºsqueda & IA
    â”‚    â”‚   â”‚   â””â”€â”€ transcriptions
    â”‚    â”‚   â”œâ”€â”€ Sistema
    â”‚    â”‚   â”‚   â”œâ”€â”€ scraping_status
    â”‚    â”‚   â”‚   â”œâ”€â”€ jobs
    â”‚    â”‚   â”‚   â”œâ”€â”€ users
    â”‚    â”‚   â”‚   â”œâ”€â”€ user_lists
    â”‚    â”‚   â”‚   â”œâ”€â”€ user_post_data
    â”‚    â”‚   â”‚   â”œâ”€â”€ system_config
    â”‚    â”‚   â”‚   â””â”€â”€ audit_log
    â”‚    â”‚   â”œâ”€â”€ Vistas (2)
    â”‚    â”‚   â”‚   â”œâ”€â”€ posts_with_media
    â”‚    â”‚   â”‚   â””â”€â”€ collection_posts_view
    â”‚    â”‚   â””â”€â”€ Ãndices (44) + Triggers
    â”‚    â”œâ”€â”€ schema_v2.sql (multi-source)
    â”‚    â”œâ”€â”€ schema_posts.sql
    â”‚    â””â”€â”€ migrations/
    â”‚
    â”œâ”€â”€â”€ SCRIPTS UTILIDAD (scripts/)
    â”‚    â”œâ”€â”€ Setup & Infraestructura
    â”‚    â”‚   â”œâ”€â”€ setup_phase0.sh
    â”‚    â”‚   â””â”€â”€ test_connections.py
    â”‚    â”œâ”€â”€ Respaldo
    â”‚    â”‚   â”œâ”€â”€ backup_database.sh
    â”‚    â”‚   â”œâ”€â”€ restore_backup.sh
    â”‚    â”‚   â””â”€â”€ restore_oldest_backup.sh
    â”‚    â”œâ”€â”€ Migraciones
    â”‚    â”‚   â”œâ”€â”€ migrate_firebase_to_postgres.py
    â”‚    â”‚   â””â”€â”€ migrate_to_schema_v2.py
    â”‚    â””â”€â”€ Sistema
    â”‚        â”œâ”€â”€ start_web_viewer.sh
    â”‚        â”œâ”€â”€ verify_schema_v2.sh
    â”‚        â””â”€â”€ audit_codebase.sh
    â”‚
    â”œâ”€â”€â”€ HERRAMIENTAS DEBUG (tools/)
    â”‚    â”œâ”€â”€ Testing
    â”‚    â”‚   â”œâ”€â”€ test_login.py
    â”‚    â”‚   â”œâ”€â”€ test_single_post.py
    â”‚    â”‚   â””â”€â”€ test_media_downloader.py
    â”‚    â”œâ”€â”€ ValidaciÃ³n
    â”‚    â”‚   â”œâ”€â”€ validate_phase2_upsert.py
    â”‚    â”‚   â”œâ”€â”€ diagnose_phase2_data.py
    â”‚    â”‚   â””â”€â”€ verify_post_ownership.py
    â”‚    â”œâ”€â”€ Fixes
    â”‚    â”‚   â”œâ”€â”€ fix_post_creator.py
    â”‚    â”‚   â”œâ”€â”€ fix_creator_mismatch.py
    â”‚    â”‚   â””â”€â”€ reset_creator_postgresql.py
    â”‚    â””â”€â”€ AnÃ¡lisis
    â”‚        â”œâ”€â”€ analyze_media_structure.py
    â”‚        â”œâ”€â”€ find_youtube_posts.py
    â”‚        â””â”€â”€ (30+ scripts mÃ¡s)
    â”‚
    â”œâ”€â”€â”€ CONFIGURACIÃ“N (config/)
    â”‚    â”œâ”€â”€ .env (variables de entorno)
    â”‚    â”œâ”€â”€ settings.json (media & scraping config)
    â”‚    â”œâ”€â”€ creators.json (4 creadores)
    â”‚    â”œâ”€â”€ credentials.json
    â”‚    â”œâ”€â”€ patreon_cookies.json
    â”‚    â””â”€â”€ gunicorn.conf.py
    â”‚
    â”œâ”€â”€â”€ DATOS (data/ - gitignored)
    â”‚    â”œâ”€â”€ media/
    â”‚    â”‚   â”œâ”€â”€ images/
    â”‚    â”‚   â”‚   â”œâ”€â”€ astrobymax/
    â”‚    â”‚   â”‚   â”œâ”€â”€ headonhistory/
    â”‚    â”‚   â”‚   â”œâ”€â”€ horoiproject/
    â”‚    â”‚   â”‚   â””â”€â”€ skyscript/
    â”‚    â”‚   â”œâ”€â”€ videos/
    â”‚    â”‚   â”œâ”€â”€ audio/
    â”‚    â”‚   â”œâ”€â”€ attachments/
    â”‚    â”‚   â””â”€â”€ collections/
    â”‚    â”œâ”€â”€ backups/
    â”‚    â”œâ”€â”€ raw/
    â”‚    â””â”€â”€ processed/
    â”‚
    â”œâ”€â”€â”€ ARCHIVO (archive/)
    â”‚    â”œâ”€â”€ docs/ (15 docs antiguas)
    â”‚    â”œâ”€â”€ phase1-firebase/
    â”‚    â”œâ”€â”€ phase2-firebase-tracker/
    â”‚    â”œâ”€â”€ phase3-notion-upload/
    â”‚    â”œâ”€â”€ scripts-old/
    â”‚    â””â”€â”€ debug-scripts/
    â”‚
    â”œâ”€â”€â”€ CONTROL DE VERSIONES (.git)
    â”‚    â”œâ”€â”€ Rama activa: main
    â”‚    â”œâ”€â”€ Estado: Clean
    â”‚    â””â”€â”€ Ãšltimos commits: FEAT features recientes
    â”‚
    â””â”€â”€â”€ STACK TECNOLÃ“GICO
         â”œâ”€â”€ Lenguaje
         â”‚   â”œâ”€â”€ Python 3.10+ (backend)
         â”‚   â””â”€â”€ Bash (scripts)
         â”œâ”€â”€ Bases de Datos
         â”‚   â”œâ”€â”€ PostgreSQL 16+
         â”‚   â”‚   â”œâ”€â”€ pgvector (embeddings)
         â”‚   â”‚   â”œâ”€â”€ Full-text search
         â”‚   â”‚   â””â”€â”€ JSON/Arrays
         â”‚   â””â”€â”€ Firebase (legacy - deprecado)
         â”œâ”€â”€ Cache & Queue
         â”‚   â”œâ”€â”€ Redis 7+
         â”‚   â”œâ”€â”€ Celery 5.3.4+
         â”‚   â””â”€â”€ Flower (monitoreo)
         â”œâ”€â”€ Web Framework
         â”‚   â”œâ”€â”€ Flask 3.0.0+
         â”‚   â”œâ”€â”€ Gunicorn 21.2.0+
         â”‚   â”œâ”€â”€ Flask-Security-Too
         â”‚   â””â”€â”€ Flask-Caching
         â”œâ”€â”€ ORM & Migraciones
         â”‚   â”œâ”€â”€ SQLAlchemy 2.0.23+
         â”‚   â”œâ”€â”€ Alembic 1.13.0+
         â”‚   â””â”€â”€ psycopg2-binary
         â”œâ”€â”€ Web Scraping
         â”‚   â”œâ”€â”€ Selenium 4.15.0+
         â”‚   â”œâ”€â”€ BeautifulSoup4 4.12.0+
         â”‚   â”œâ”€â”€ lxml 4.9.0+
         â”‚   â””â”€â”€ Requests 2.31.0+
         â”œâ”€â”€ Multimedia
         â”‚   â”œâ”€â”€ yt-dlp 2023.7.6+
         â”‚   â”œâ”€â”€ moviepy 1.0.3+
         â”‚   â”œâ”€â”€ pydub 0.25.1+
         â”‚   â””â”€â”€ Pillow 10.0.0+
         â”œâ”€â”€ IA & NLP
         â”‚   â”œâ”€â”€ google-generativeai 0.3.0+
         â”‚   â”œâ”€â”€ Whoosh 2.7.4
         â”‚   â””â”€â”€ WebVTT-py 0.5.0
         â””â”€â”€ Infraestructura
             â”œâ”€â”€ Docker Compose
             â””â”€â”€ Git

================================================================================
FLUJO DE DATOS
================================================================================

Patreon Website
    â†“ (Selenium autenticaciÃ³n)
Phase 1: URL Collector
    â†“ (Recolecta URLs posts)
Phase 2: Detail Extractor
    â”œâ”€â†’ Content Parser
    â””â”€â†’ Media Downloader
    â†“ (Extrae contenido completo)
PostgreSQL Database (alejandria)
    â”œâ”€â†’ posts table
    â”œâ”€â†’ media_files table
    â””â”€â†’ scraping_status table
    â†“
Phase 3: Collections Scraper
    â†“ (Organiza en colecciones)
Web Viewer (Flask)
    â”œâ”€â†’ Search Indexer (Whoosh)
    â””â”€â†’ VisualizaciÃ³n
    â†“
Frontend Web
    â”œâ”€â†’ BÃºsqueda de posts
    â”œâ”€â†’ VisualizaciÃ³n de media
    â””â”€â†’ ExploraciÃ³n de colecciones

================================================================================
PROGRESO DEL PROYECTO
================================================================================

Phase 0: Infrastructure âœ… COMPLETADA
â”œâ”€ PostgreSQL 16 setup
â”œâ”€ pgvector extension
â”œâ”€ Redis 7 setup
â”œâ”€ Celery 5.3.4 setup
â””â”€ Schema base creation

Phase 1: Data Migration âœ… COMPLETADA
â”œâ”€ 982 posts Firebase â†’ PostgreSQL
â”œâ”€ Schema V1 â†’ V2 migration
â””â”€ VerificaciÃ³n de integridad

Phase 1.5: Schema Refactor âœ… COMPLETADA
â”œâ”€ Multi-source architecture
â”œâ”€ NormalizaciÃ³n de datos
â””â”€ Ãndices optimizados

Phase 2: Core Backend ğŸ”„ EN CURSO
â”œâ”€ MigraciÃ³n scripts â†’ PostgreSQL
â”œâ”€ PostgresTracker implementation
â”œâ”€ Search improvements
â””â”€ Celery workers setup

Phase 3+: Advanced Features ğŸ“… PENDIENTE
â”œâ”€ BÃºsqueda semÃ¡ntica (pgvector)
â”œâ”€ Transcripciones (Whisper)
â”œâ”€ Web app completa
â””â”€ Otras plataformas

================================================================================
CREADORES CONFIGURADOS
================================================================================

1. astrobymax (AstroByMax)
   - URL: https://www.patreon.com/cw/astrobymax/posts
   - Color: #52bca3
   - Posts: ~ (en base de datos)
   
2. horoiproject (HOROI Project)
   - URL: https://www.patreon.com/horoiproject/posts
   - Color: #9f7766
   - Posts: ~ (en base de datos)

3. headonhistory (Ali A Olomi)
   - URL: https://www.patreon.com/headonhistory/posts
   - Color: #4ba3e8
   - Posts: ~ (en base de datos)

4. skyscript (Skyscript)
   - URL: https://www.patreon.com/c/skyscript/posts
   - Color: #0c0a61
   - Posts: ~ (en base de datos)

TOTAL: 982 posts migrados a PostgreSQL

================================================================================
ARCHIVOS CLAVE PARA EXPLORAR
================================================================================

INICIO:
  README.md - Entrada principal del proyecto

DOCUMENTACIÃ“N TÃ‰CNICA:
  docs/ARCHITECTURE.md - DiseÃ±o completo del sistema

TRACKING:
  PROGRESS.md - Estado detallado de migraciÃ³n

INSTALACIÃ“N:
  docs/PHASE0_INSTALLATION.md - GuÃ­a de setup

DATABASE:
  database/schema.sql - Estructura completa DB

CONFIGURACIÃ“N:
  config/settings.json - ParÃ¡metros scraping
  config/creators.json - Creadores configurados

SCRAPERS:
  src/phase2_detail_extractor.py - Scraper principal

WEB:
  web/viewer.py - Interfaz web Flask

SCRIPTS:
  scripts/test_connections.py - Verifica conectividad

================================================================================
ESTADÃSTICAS CLAVE
================================================================================

CÃ³digo:
  - 12,416 lÃ­neas Python en src/
  - 100+ scripts totales
  - 256 archivos documentaciÃ³n

Base de Datos:
  - 14 tablas
  - 2 vistas
  - 44 Ã­ndices
  - 982 posts migrados

Infraestructura:
  - PostgreSQL 16
  - Redis 7
  - Flask 3.0.0
  - 40+ dependencias Python

Proyecto:
  - 5 fases principales
  - 4 creadores activos
  - ~8.9 GB total
  - ActualizaciÃ³n continua

